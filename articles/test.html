<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Testing DBI backends • DBItest</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Testing DBI backends">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DBItest</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.6.0.9004</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/test.html">Testing DBI backends</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/r-dbi/DBItest">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Testing DBI backends</h1>
                        <h4 class="author">Kirill Müller</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-dbi/DBItest/blob/master/vignettes/test.Rmd"><code>vignettes/test.Rmd</code></a></small>
      <div class="hidden name"><code>test.Rmd</code></div>

    </div>

    
    
<p>This document shows how to use the <code>DBItest</code> package when implementing a new <code>DBI</code> backend or when applying it to an existing backend. The <code>DBItest</code> package provides a large collection of automated tests.</p>
<div id="testing-a-new-backend" class="section level2">
<h2 class="hasAnchor">
<a href="#testing-a-new-backend" class="anchor"></a>Testing a new backend</h2>
<p>The test cases in the <code>DBItest</code> package are structured very similarly to the sections in the “backend” vignette:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/vignette.html">vignette</a></span>(<span class="st">"backend"</span>, <span class="dt">package =</span> <span class="st">"DBI"</span>)</a></code></pre></div>
<p>Like the “backend” vignette, this vignette assumes that you are implementing the <code>RKazam</code> package that has a <code>Kazam()</code> function that creates a new <code>DBIDriver</code> instance for connecting to a “Kazam” database.</p>
<p>You can add the tests in the <code>DBItest</code> package incrementally, as you proceed with implementing the various parts of the DBI. The <code>DBItest</code> package builds upon the <code>testthat</code> package. To enable it, run the following in your package directory (after installing or updating <code>devtools</code>):</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">devtools<span class="op">::</span><span class="kw">use_testthat</span>()</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">devtools<span class="op">::</span><span class="kw">use_test</span>(<span class="st">"DBItest"</span>)</a></code></pre></div>
<p>This creates, among others, a file <code>test-DBItest.R</code> in the <code>tests/testthat</code> directory. Replace its entire contents by the following:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">DBItest<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/DBItest/man/context.html">make_context</a></span>(<span class="kw">Kazam</span>(), <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">DBItest<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/DBItest/man/test_getting_started.html">test_getting_started</a></span>()</a></code></pre></div>
<p>Now test your package with <code><a href="https://rdrr.io/pkg/devtools/man/test.html">devtools::test()</a></code>. If you followed at least the “Getting started” section of the <code>DBI</code> “backend” vignette, all tests should succeed.</p>
<p>By adding the corresponding test function to your <code>tests/test-DBItest.R</code> file <em>before</em> implementing a section, you get immediate feedback which functionality of this section still needs to be implemented by running <code><a href="https://rdrr.io/pkg/devtools/man/test.html">devtools::test()</a></code> again. Therefore, proceed by appending the following to <code>tests/test-DBItest.R</code>, to include a test case for the forthcoming section:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">DBItest<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/DBItest/man/test_driver.html">test_driver</a></span>()</a></code></pre></div>
<p>Again, all tests should succeed when you are done with the “Driver” section. Add the call to the next tester function, implement the following section until all tests succeed, and so forth.</p>
<p>In this scenario, you are usually interested only in the first error the test suite finds. The <code>StopReporter</code> of <code>testthat</code> is most helpful here, activate it by passing <code>reporter = "stop"</code> to <code><a href="https://rdrr.io/pkg/devtools/man/test.html">devtools::test()</a></code>. Alternatively, call the relevant <code>DBItest::test_()</code> function directly.</p>
<p>The tests are documented with the corresponding functions: For instance, <code><a href="../reference/test_driver.html">?test_driver</a></code> shows a coarse description of all tests for the “Driver” test case. Test failures will include the name of the test that is failing; in this case, investigating the documentation or the source code of the <code>DBItest</code> package will usually lead to the cause of the error.</p>
<p>Not all tests can be satisfied: For example, there is one test that tests that <code>logical</code> variables survive a write-read roundtrip to the database, whereas another test tests that <code>logical</code> variables are converted to <code>integer</code> in such a case. Tests can be skipped by adding regular expressions for the tests to skip as character vector to the call, as in the following[^termnull]:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">DBItest<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/DBItest/man/test_driver.html">test_driver</a></span>(<span class="dt">skip =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">  <span class="st">"data_type"</span>           <span class="co"># Reason 1...</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3">  <span class="st">"constructor.*"</span>,      <span class="co"># Reason 2...</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">  <span class="ot">NULL</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">))</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">[<span class="op">^</span>termnull]<span class="op">:</span><span class="st"> </span>The terminating <span class="st">`</span><span class="dt">NULL</span><span class="st">`</span> allows appending new lines to the end by copy<span class="op">-</span>pasting an existing line, without having to take care of the terminating comma.</a></code></pre></div>
<p>Some other reasons to skip tests are: - your database does not support a feature - you want to postpone or avoid the implementation of a feature - the test takes too long to run</p>
</div>
<div id="testing-an-existing-backend" class="section level2">
<h2 class="hasAnchor">
<a href="#testing-an-existing-backend" class="anchor"></a>Testing an existing backend</h2>
<p>For an existing backends, simply enabling all tests may be the quickest way to get started. Run the following in your package directory (after installing or updating <code>devtools</code>):</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">devtools<span class="op">::</span><span class="kw">use_testthat</span>()</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">devtools<span class="op">::</span><span class="kw">use_test</span>(<span class="st">"DBItest"</span>)</a></code></pre></div>
<p>This creates, among others, a file <code>test-DBItest.R</code> in the <code>tests/testthat</code> directory. Replace its entire contents by the following:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">DBItest<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/DBItest/man/context.html">make_context</a></span>(<span class="kw">Kazam</span>(), <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">DBItest<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/DBItest/man/test_all.html">test_all</a></span>()</a></code></pre></div>
<p>The notes about “Kazam” and skipping tests from the previous section apply here as well. The <code><a href="../reference/test_all.html">test_all()</a></code> function simply calls all test cases.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#testing-a-new-backend">Testing a new backend</a></li>
      <li><a href="#testing-an-existing-backend">Testing an existing backend</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://krlmlr.info">Kirill Müller</a>, <a href="https://www.r-consortium.org">R Consortium</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
